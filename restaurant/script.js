const translations = {
    en: {
        page_title: "Sura | Korean Restaurant in Dresden",
        nav_home: "Home",
        nav_about: "About Us",
        nav_menu: "Menu",
        nav_location: "Location",
        nav_reservation: "Reservation",
        hero_reservation: "Make a Reservation",
        about_subtitle: "Our Story",
        about_title: "About Us",
        about_desc_1: "Sura was founded in 2020 with a clear vision: to bring authentic Korean cuisine to Dresden. Our name 'Sura' comes from the Korean word for the royal table – a symbol of the highest quality and care in preparation.",
        about_desc_2: "Every dish is prepared with fresh ingredients and traditional recipes passed down through generations. We invite you to discover the diversity of Korean cuisine – from spicy Kimchi to tender Bulgogi.",
        hero_title: "Sura Dresden",
        hero_desc: "The premier Korean restaurant in Dresden. Experience authentic culinary magic in the heart of Neustadt.",
        hero_btn: "Explore Menu",
        exp_subtitle: "Atmosphere",
        exp_title: "Welcome to Sura",
        exp_desc: "Located on Königsbrücker Straße 50, Sura is the destination for authentic Korean cuisine in Dresden. We invite you to linger, relax, and let us enchant you with our traditional flavors and warm hospitality.",
        menu_btn: "Explore Menu",
        loc_subtitle: "Visit Us",
        loc_title: "Location & Hours",
        loc_address: "Address",
        loc_hours: "Opening Hours",
        loc_contact: "Contact",
        loc_reservation: "Reservation",
        loc_reservation_info: "Table reservations by phone at<br>0351 810 747 89",
        loc_call_now: "Call Now",
        testimonials_subtitle: "Reviews",
        testimonials_title: "What Our Guests Say",
        testimonial_1_text: "\"The best Korean food I've ever had outside of Korea! The Bulgogi was incredibly tender and the atmosphere is simply wonderful.\"",
        testimonial_2_text: "\"Authentic, delicious, and prepared with love. The Bibimbap in the hot stone pot is a must! Friendly service and fair prices.\"",
        testimonial_3_text: "\"Finally a restaurant in Dresden that serves real Korean cuisine! The Kimchi Jjigae tastes just like my grandmother's in Seoul.\"",
        testimonial_4_text: "\"I was impressed by the elegance of the flavors. The Kimchi Jjigae has the perfect balance of spice and depth. A truly high-end dining experience.\"",
        testimonial_5_text: "\"The atmosphere is amazing, perfect for a romantic dinner. Service was attentive and the Japchae was flavorful. Highly recommend!\"",
        testimonial_6_text: "\"The best bibimbap in the city, hands down. The ingredients are so fresh and the stone bowl stayed hot till the last bite!\"",
        testimonials_btn_google: "Review on Google",
        testimonials_btn_tripadvisor: "Review on TripAdvisor",
        rating_google: "4.5 out of 5 stars (1,037 reviews)",
        rating_tripadvisor: "4.2 out of 5 stars (73 reviews)",
        reviews_title: "Reviews",
        widget_reviews_count: "1,037 reviews",
        widget_reviews_count_ta: "73 reviews",
        widget_see_reviews: "See all reviews",
        ratings_disclaimer: "As of January 2026",
        footer_rights: "© 2025 Sura Korean Restaurant Dresden. All rights reserved."
    },
    de: {
        page_title: "Sura | Koreanisches Restaurant in Dresden",
        nav_home: "Startseite",
        nav_about: "Über Uns",
        nav_menu: "Menü",
        nav_location: "Standort",
        nav_reservation: "Reservierung",
        hero_reservation: "Tisch reservieren",
        about_subtitle: "Unsere Geschichte",
        about_title: "Über Uns",
        about_desc_1: "Das Sura wurde 2020 mit einer klaren Vision gegründet: Die authentische koreanische Küche nach Dresden zu bringen. Unser Name \"Sura\" stammt vom koreanischen Wort für die königliche Tafel – ein Symbol für die höchste Qualität und Sorgfalt bei der Zubereitung.",
        about_desc_2: "Jedes Gericht wird mit frischen Zutaten und nach traditionellen Rezepten zubereitet, die von Generation zu Generation weitergegeben wurden. Wir laden Sie ein, die Vielfalt der koreanischen Küche zu entdecken – von würzigem Kimchi bis hin zu zartem Bulgogi.",
        hero_title: "Sura Dresden",
        hero_desc: "DAS koreanische Restaurant in Dresden. Erleben Sie kulinarische Zauber im Herzen der Neustadt.",
        hero_btn: "Speisekarte",
        exp_subtitle: "Atmosphere",
        exp_title: "Willkommen im Sura",
        exp_desc: "Gelegen in der Königsbrückerstr. 50, ist das Sura die Adresse für authentische koreanische Küche in Dresden. Wir laden Sie ein, zu verweilen, zu entspannen und sich von unseren traditionellen Aromen verzaubern zu lassen.",
        menu_btn: "Speisekarte ansehen (PDF)",
        loc_subtitle: "Besuchen Sie Uns",
        loc_title: "Standort & Zeiten",
        loc_address: "Adresse",
        loc_hours: "Öffnungszeiten",
        loc_contact: "Kontakt",
        loc_reservation: "Reservierung",
        loc_reservation_info: "Tischreservierung telefonisch unter<br>0351 810 747 89",
        loc_call_now: "Jetzt anrufen",
        testimonials_subtitle: "Kundenstimmen",
        testimonials_title: "Was unsere Gäste sagen",
        testimonial_1_text: "\"Das beste koreanische Essen, das ich je außerhalb Koreas gegessen habe! Das Bulgogi war unglaublich zart und die Atmosphäre ist einfach wunderbar.\"",
        testimonial_2_text: "\"Authentisch, lecker und mit Liebe zubereitet. Das Bibimbap im heißen Steintopf ist ein Muss! Freundlicher Service und faire Preise.\"",
        testimonial_3_text: "\"Endlich ein Restaurant in Dresden, das echte koreanische Küche serviert! Das Kimchi Jjigae schmeckt wie bei meiner Oma in Seoul.\"",
        testimonial_4_text: "\"Ich war von der Eleganz der Aromen beeindruckt. Das Kimchi Jjigae hat die perfekte Balance zwischen Schärfe und Tiefe. Ein wirklich erstklassiges Restauranterlebnis.\"",
        testimonial_5_text: "\"Die Atmosphäre ist fantastisch, perfekt für ein romantisches Abendessen. Der Service war aufmerksam und das Japchae war voller Geschmack. Sehr zu empfehlen!\"",
        testimonial_6_text: "\"Das beste Bibimbap der Stadt, ohne Zweifel. Die Zutaten sind so frisch und der Steintopf blieb bis zum letzten Bissen heiß!\"",
        testimonials_btn_google: "Google Bewertung",
        testimonials_btn_tripadvisor: "TripAdvisor Bewertung",
        rating_google: "4.5 von 5 Sternen (1.037 Bewertungen)",
        rating_tripadvisor: "4.2 von 5 Sternen (73 Bewertungen)",
        reviews_title: "Bewertungen",
        widget_reviews_count: "1.037 Bewertungen",
        widget_reviews_count_ta: "73 Bewertungen",
        widget_see_reviews: "Alle Bewertungen ansehen",
        ratings_disclaimer: "Stand: Januar 2026",
        footer_rights: "© 2025 Sura Koreanisches Restaurant Dresden. Alle Rechte vorbehalten."
    }
};

document.addEventListener('DOMContentLoaded', () => {
    const navbar = document.getElementById('navbar');

    // Navbar scroll effect
    window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    // Language Switching Logic
    const langSelectors = document.querySelectorAll('.lang-btn');

    function setLanguage(lang) {
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (translations[lang][key]) {
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    el.placeholder = translations[lang][key];
                } else if (el.tagName === 'OPTION') {
                    el.textContent = translations[lang][key];
                } else {
                    el.innerHTML = translations[lang][key];
                }
            }
        });

        // Update page title
        document.title = translations[lang]['page_title'];

        // Update active button state
        langSelectors.forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
        });

        // Set HTML lang attribute
        document.documentElement.lang = lang;

        // Save preference
        localStorage.setItem('preferredLang', lang);
    }

    langSelectors.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            setLanguage(lang);
        });
    });

    // Load preferred language or default to German
    const savedLang = localStorage.getItem('preferredLang') || 'de';
    setLanguage(savedLang);

    // Mobile Menu Toggle
    const mobileNavToggle = document.getElementById('mobileNavToggle');
    const navLinks = document.getElementById('navLinks');

    if (mobileNavToggle) {
        mobileNavToggle.addEventListener('click', () => {
            const isExpanded = mobileNavToggle.classList.toggle('active');
            navLinks.classList.toggle('active');
            mobileNavToggle.setAttribute('aria-expanded', isExpanded);
            mobileNavToggle.setAttribute('aria-label', isExpanded ? 'Menü schließen' : 'Menü öffnen');
        });
    }

    // Modal Logic with focus management
    const reservationModal = document.getElementById('reservationModal');
    const reservationTriggers = document.querySelectorAll('#navReservation, #heroReservation');
    const closeModalBtn = document.getElementById('closeModal');
    const modalOverlay = document.getElementById('modalOverlay');
    let lastFocusedElement = null;

    if (reservationModal && reservationTriggers.length > 0) {
        // Get all focusable elements in modal
        const getFocusableElements = () => {
            return reservationModal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
        };

        reservationTriggers.forEach(trigger => {
            trigger.addEventListener('click', (e) => {
                e.preventDefault();
                lastFocusedElement = document.activeElement;
                reservationModal.classList.add('active');
                reservationModal.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';

                // Focus the close button when modal opens
                setTimeout(() => closeModalBtn.focus(), 100);

                // Close mobile menu if open
                if (navLinks && navLinks.classList.contains('active')) {
                    mobileNavToggle.classList.remove('active');
                    navLinks.classList.remove('active');
                }
            });
        });

        const closeModal = () => {
            reservationModal.classList.remove('active');
            reservationModal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';

            // Return focus to the element that opened the modal
            if (lastFocusedElement) {
                lastFocusedElement.focus();
            }
        };

        closeModalBtn.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', closeModal);

        // Keyboard handling: Escape to close, Tab to trap focus
        document.addEventListener('keydown', (e) => {
            if (!reservationModal.classList.contains('active')) return;

            if (e.key === 'Escape') {
                closeModal();
                return;
            }

            // Trap focus inside modal
            if (e.key === 'Tab') {
                const focusableElements = getFocusableElements();
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey && document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }
        });
    }

    // Smooth scroll for navigation links
    document.querySelectorAll('a[href^="#"]:not([href="#reservation"])').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            if (targetId === '#') return;

            // Close mobile menu if open
            if (navLinks && navLinks.classList.contains('active')) {
                mobileNavToggle.classList.remove('active');
                navLinks.classList.remove('active');
            }

            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                const navOffset = 80;
                const elementPosition = targetElement.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - navOffset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });

    // Simple reveal animation on scroll
    const observerOptions = {
        threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    document.querySelectorAll('.info-content, .info-image, .section-header').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'all 0.8s cubic-bezier(0.165, 0.84, 0.44, 1)';
        observer.observe(el);
    });

    // Testimonials Slider Logic with Auto-play
    const slider = document.querySelector('.testimonials-slider');
    const sliderContainer = document.querySelector('.testimonials-slider-container');
    const prevBtn = document.querySelector('.slider-btn.prev');
    const nextBtn = document.querySelector('.slider-btn.next');

    if (slider && sliderContainer && prevBtn && nextBtn) {
        let currentIndex = 0;
        const cards = document.querySelectorAll('.testimonial-card');
        let autoplayInterval = null;
        const AUTOPLAY_DELAY = 5000; // 5 seconds

        function updateSlider() {
            const cardWidth = cards[0].offsetWidth;
            const gap = parseInt(window.getComputedStyle(slider).gap);
            const moveAmount = currentIndex * (cardWidth + gap);

            slider.style.transform = `translateX(-${moveAmount}px)`;

            // Limit checks
            const visibleWidth = sliderContainer.offsetWidth - (parseInt(window.getComputedStyle(sliderContainer).paddingLeft) * 2);
            const totalWidth = slider.scrollWidth;

            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = moveAmount + visibleWidth >= totalWidth;
        }

        function nextSlide() {
            const cardsVisible = Math.floor(sliderContainer.offsetWidth / cards[0].offsetWidth);
            const visibleWidth = sliderContainer.offsetWidth - (parseInt(window.getComputedStyle(sliderContainer).paddingLeft) * 2);
            const cardWidth = cards[0].offsetWidth;
            const gap = parseInt(window.getComputedStyle(slider).gap);
            const moveAmount = currentIndex * (cardWidth + gap);

            // If at end, loop back to start
            if (moveAmount + visibleWidth >= slider.scrollWidth) {
                currentIndex = 0;
            } else {
                currentIndex += 1;
                if (currentIndex >= cards.length) currentIndex = 0;
            }
            updateSlider();
        }

        function startAutoplay() {
            if (!autoplayInterval) {
                autoplayInterval = setInterval(nextSlide, AUTOPLAY_DELAY);
            }
        }

        function stopAutoplay() {
            if (autoplayInterval) {
                clearInterval(autoplayInterval);
                autoplayInterval = null;
            }
        }

        // Pause on hover
        sliderContainer.addEventListener('mouseenter', stopAutoplay);
        sliderContainer.addEventListener('mouseleave', startAutoplay);

        // Pause on focus (accessibility)
        sliderContainer.addEventListener('focusin', stopAutoplay);
        sliderContainer.addEventListener('focusout', startAutoplay);

        nextBtn.addEventListener('click', () => {
            const cardsVisible = Math.floor(sliderContainer.offsetWidth / cards[0].offsetWidth);
            currentIndex += cardsVisible;
            if (currentIndex >= cards.length) currentIndex = cards.length - 1;
            updateSlider();
        });

        prevBtn.addEventListener('click', () => {
            const cardsVisible = Math.floor(sliderContainer.offsetWidth / cards[0].offsetWidth);
            currentIndex -= cardsVisible;
            if (currentIndex < 0) currentIndex = 0;
            updateSlider();
        });

        window.addEventListener('resize', () => {
            currentIndex = 0;
            updateSlider();
        });

        // Initial setup
        updateSlider();
        startAutoplay();
    }

    // Back to Top Button
    const backToTopBtn = document.getElementById('backToTop');
    if (backToTopBtn) {
        window.addEventListener('scroll', () => {
            if (window.scrollY > 500) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
        });

        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    }

    // Lazy load Google Maps iframe
    const mapIframe = document.querySelector('.location-map iframe[data-src]');
    if (mapIframe) {
        const mapObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const iframe = entry.target;
                    iframe.src = iframe.dataset.src;
                    mapObserver.unobserve(iframe);
                }
            });
        }, { rootMargin: '200px' }); // Load slightly before it comes into view

        mapObserver.observe(mapIframe);
    }
});
