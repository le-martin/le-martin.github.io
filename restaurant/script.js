const translations = {
    en: {
        page_title: "Sura | Korean Restaurant in Dresden",
        nav_home: "Home",
        nav_about: "About Us",
        nav_menu: "Menu",
        nav_location: "Location",
        nav_reservation: "Reservation",
        hero_reservation: "Make a Reservation",
        about_subtitle: "Our Story",
        about_title: "About Us",
        about_desc_1: "Sura was founded in 2020 with a clear vision: to bring authentic Korean cuisine to Dresden. Our name 'Sura' comes from the Korean word for the royal table – a symbol of the highest quality and care in preparation.",
        about_desc_2: "Every dish is prepared with fresh ingredients and traditional recipes passed down through generations. We invite you to discover the diversity of Korean cuisine – from spicy Kimchi to tender Bulgogi.",
        hero_title: "Sura Dresden",
        hero_desc: "The premier Korean restaurant in Dresden. Experience authentic culinary magic in the heart of Neustadt.",
        hero_btn: "Explore Menu",
        exp_subtitle: "Atmosphere",
        exp_title: "Welcome to Sura",
        exp_desc: "Located on Königsbrücker Straße 50, Sura is the destination for authentic Korean cuisine in Dresden. We invite you to linger, relax, and let us enchant you with our traditional flavors and warm hospitality.",
        menu_btn: "Explore Menu",
        loc_subtitle: "Visit Us",
        loc_title: "Location & Hours",
        loc_address: "Address",
        loc_hours: "Opening Hours",
        loc_contact: "Contact",
        loc_reservation: "Reservation",
        loc_reservation_info: "Table reservations by phone at<br>0351 810 747 89",
        loc_call_now: "Call Now",
        testimonials_subtitle: "Reviews",
        testimonials_title: "What Our Guests Say",
        testimonial_1_text: "\"The best Korean food I've ever had outside of Korea! The Bulgogi was incredibly tender and the atmosphere is simply wonderful.\"",
        testimonial_2_text: "\"Authentic, delicious, and prepared with love. The Bibimbap in the hot stone pot is a must! Friendly service and fair prices.\"",
        testimonial_3_text: "\"Finally a restaurant in Dresden that serves real Korean cuisine! The Kimchi Jjigae tastes just like my grandmother's in Seoul.\"",
        testimonial_4_text: "\"I was impressed by the elegance of the flavors. The Kimchi Jjigae has the perfect balance of spice and depth. A truly high-end dining experience.\"",
        testimonial_5_text: "\"The atmosphere is amazing, perfect for a romantic dinner. Service was attentive and the Japchae was flavorful. Highly recommend!\"",
        testimonial_6_text: "\"The best bibimbap in the city, hands down. The ingredients are so fresh and the stone bowl stayed hot till the last bite!\"",
        testimonials_btn_google: "Review on Google",
        testimonials_btn_tripadvisor: "Review on TripAdvisor",
        rating_google: "4.5 out of 5 stars (1,037 reviews)",
        rating_tripadvisor: "4.2 out of 5 stars (73 reviews)",
        footer_rights: "© 2025 Sura Korean Restaurant Dresden. All rights reserved."
    },
    de: {
        page_title: "Sura | Koreanisches Restaurant in Dresden",
        nav_home: "Startseite",
        nav_about: "Über Uns",
        nav_menu: "Menü",
        nav_location: "Standort",
        nav_reservation: "Reservierung",
        hero_reservation: "Tisch reservieren",
        about_subtitle: "Unsere Geschichte",
        about_title: "Über Uns",
        about_desc_1: "Das Sura wurde 2020 mit einer klaren Vision gegründet: Die authentische koreanische Küche nach Dresden zu bringen. Unser Name \"Sura\" stammt vom koreanischen Wort für die königliche Tafel – ein Symbol für die höchste Qualität und Sorgfalt bei der Zubereitung.",
        about_desc_2: "Jedes Gericht wird mit frischen Zutaten und nach traditionellen Rezepten zubereitet, die von Generation zu Generation weitergegeben wurden. Wir laden Sie ein, die Vielfalt der koreanischen Küche zu entdecken – von würzigem Kimchi bis hin zu zartem Bulgogi.",
        hero_title: "Sura Dresden",
        hero_desc: "DAS koreanische Restaurant in Dresden. Erleben Sie kulinarische Zauber im Herzen der Neustadt.",
        hero_btn: "Speisekarte",
        exp_subtitle: "Atmosphere",
        exp_title: "Willkommen im Sura",
        exp_desc: "Gelegen in der Königsbrückerstr. 50, ist das Sura die Adresse für authentische koreanische Küche in Dresden. Wir laden Sie ein, zu verweilen, zu entspannen und sich von unseren traditionellen Aromen verzaubern zu lassen.",
        menu_btn: "Speisekarte ansehen (PDF)",
        loc_subtitle: "Besuchen Sie Uns",
        loc_title: "Standort & Zeiten",
        loc_address: "Adresse",
        loc_hours: "Öffnungszeiten",
        loc_contact: "Kontakt",
        loc_reservation: "Reservierung",
        loc_reservation_info: "Tischreservierung telefonisch unter<br>0351 810 747 89",
        loc_call_now: "Jetzt anrufen",
        testimonials_subtitle: "Kundenstimmen",
        testimonials_title: "Was unsere Gäste sagen",
        testimonial_1_text: "\"Das beste koreanische Essen, das ich je außerhalb Koreas gegessen habe! Das Bulgogi war unglaublich zart und die Atmosphäre ist einfach wunderbar.\"",
        testimonial_2_text: "\"Authentisch, lecker und mit Liebe zubereitet. Das Bibimbap im heißen Steintopf ist ein Muss! Freundlicher Service und faire Preise.\"",
        testimonial_3_text: "\"Endlich ein Restaurant in Dresden, das echte koreanische Küche serviert! Das Kimchi Jjigae schmeckt wie bei meiner Oma in Seoul.\"",
        testimonial_4_text: "\"Ich war von der Eleganz der Aromen beeindruckt. Das Kimchi Jjigae hat die perfekte Balance zwischen Schärfe und Tiefe. Ein wirklich erstklassiges Restauranterlebnis.\"",
        testimonial_5_text: "\"Die Atmosphäre ist fantastisch, perfekt für ein romantisches Abendessen. Der Service war aufmerksam und das Japchae war voller Geschmack. Sehr zu empfehlen!\"",
        testimonial_6_text: "\"Das beste Bibimbap der Stadt, ohne Zweifel. Die Zutaten sind so frisch und der Steintopf blieb bis zum letzten Bissen heiß!\"",
        testimonials_btn_google: "Google Bewertung",
        testimonials_btn_tripadvisor: "TripAdvisor Bewertung",
        rating_google: "4.5 von 5 Sternen (1.037 Bewertungen)",
        rating_tripadvisor: "4.2 von 5 Sternen (73 Bewertungen)",
        footer_rights: "© 2025 Sura Koreanisches Restaurant Dresden. Alle Rechte vorbehalten."
    },
    ko: {
        page_title: "수라 | 드레스덴 한국 레스토랑",
        nav_home: "홈",
        nav_about: "소개",
        nav_menu: "메뉴",
        nav_location: "위치",
        nav_reservation: "예약",
        hero_reservation: "예약하기",
        about_subtitle: "우리의 이야기",
        about_title: "소개",
        about_desc_1: "수라는 2020년 드레스덴에 정통 한국 요리를 소개하겠다는 분명한 비전을 가지고 설립되었습니다. '수라'라는 이름은 왕의 식탁을 의미하는 한국어에서 유래했으며, 최고의 품질과 정성을 상징합니다.",
        about_desc_2: "모든 요리는 대대로 전해 내려온 전통 레시피와 신선한 재료로 정성껏 준비됩니다. 매콤한 김치부터 부드러운 불고기까지, 다양한 한국 요리의 세계로 여러분을 초대합니다.",
        hero_title: "드레스덴 수라",
        hero_desc: "드레스덴 최고의 한국 레스토랑. 노이슈타트의 중심에서 진정한 한국의 맛을 경험해 보세요.",
        hero_btn: "메뉴 보기",
        exp_subtitle: "분위기",
        exp_title: "수라에 오신 것을 환영합니다",
        exp_desc: "Königsbrücker Straße 50에 위치한 수라는 드레스덴에서 진정한 한식을 맛볼 수 있는 곳입니다. 편안한 분위기에서 전통의 맛과 정성을 다한 서비스를 즐겨보세요.",
        menu_btn: "메뉴판 보기 (PDF)",
        loc_subtitle: "오시는 길",
        loc_title: "위치 및 영업시간",
        loc_address: "주소",
        loc_hours: "영업시간",
        loc_contact: "연락처",
        loc_reservation: "예약",
        loc_reservation_info: "전화 예약<br>0351 810 747 89",
        loc_call_now: "지금 전화하기",
        testimonials_subtitle: "고객 후기",
        testimonials_title: "손님들의 이야기",
        testimonial_1_text: "\"한국 밖에서 먹어본 한식 중 최고예요! 불고기가 정말 부드럽고 분위기도 너무 좋았습니다.\"",
        testimonial_2_text: "\"정성이 느껴지는 맛있는 음식이에요. 돌솥비빔밥은 꼭 드셔보세요! 친절한 서비스와 합리적인 가격입니다.\"",
        testimonial_3_text: "\"드레스덴에서 진짜 한국 음식을 맛볼 수 있는 곳! 김치찌개가 서울에 계신 할머니 맛이에요.\"",
        testimonial_4_text: "\"맛의 우아함에 감동했습니다. 김치찌개는 매운맛과 깊은 맛이 완벽한 조화를 이룹니다. 진정한 프리미엄 다이닝 경험이었습니다.\"",
        testimonial_5_text: "\"분위기가 정말 좋아서 로맨틱한 저녁 식사에 딱이에요. 서비스도 친절하고 잡채도 정말 맛있었습니다. 강력 추천합니다!\"",
        testimonial_6_text: "\"단연코 이 도시 최고의 비빔밥입니다. 재료가 정말 신선하고 돌솥이 마지막 한 입까지 뜨겁게 유지되었어요!\"",
        testimonials_btn_google: "구글 리뷰 작성",
        testimonials_btn_tripadvisor: "트립어드바이저 리뷰 작성",
        rating_google: "별 5개 중 4.5개 (리뷰 1,037개)",
        rating_tripadvisor: "별 5개 중 4.2개 (리뷰 73개)",
        footer_rights: "© 2025 수라 드레스덴 코리안 레스토랑. All rights reserved."
    }
};

document.addEventListener('DOMContentLoaded', () => {
    const navbar = document.getElementById('navbar');

    // Navbar scroll effect
    window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });

    // Language Switching Logic
    const langSelectors = document.querySelectorAll('.lang-btn');

    function setLanguage(lang) {
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (translations[lang][key]) {
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    el.placeholder = translations[lang][key];
                } else if (el.tagName === 'OPTION') {
                    el.textContent = translations[lang][key];
                } else {
                    el.innerHTML = translations[lang][key];
                }
            }
        });

        // Update page title
        document.title = translations[lang]['page_title'];

        // Update active button state
        langSelectors.forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
        });

        // Set HTML lang attribute
        document.documentElement.lang = lang;

        // Save preference
        localStorage.setItem('preferredLang', lang);
    }

    langSelectors.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            setLanguage(lang);
        });
    });

    // Load preferred language or default to German
    const savedLang = localStorage.getItem('preferredLang') || 'de';
    setLanguage(savedLang);

    // Mobile Menu Toggle
    const mobileNavToggle = document.getElementById('mobileNavToggle');
    const navLinks = document.getElementById('navLinks');

    if (mobileNavToggle) {
        mobileNavToggle.addEventListener('click', () => {
            const isExpanded = mobileNavToggle.classList.toggle('active');
            navLinks.classList.toggle('active');
            mobileNavToggle.setAttribute('aria-expanded', isExpanded);
            mobileNavToggle.setAttribute('aria-label', isExpanded ? 'Menü schließen' : 'Menü öffnen');
        });
    }

    // Modal Logic with focus management
    const reservationModal = document.getElementById('reservationModal');
    const reservationTriggers = document.querySelectorAll('#navReservation, #heroReservation');
    const closeModalBtn = document.getElementById('closeModal');
    const modalOverlay = document.getElementById('modalOverlay');
    let lastFocusedElement = null;

    if (reservationModal && reservationTriggers.length > 0) {
        // Get all focusable elements in modal
        const getFocusableElements = () => {
            return reservationModal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
        };

        reservationTriggers.forEach(trigger => {
            trigger.addEventListener('click', (e) => {
                e.preventDefault();
                lastFocusedElement = document.activeElement;
                reservationModal.classList.add('active');
                reservationModal.setAttribute('aria-hidden', 'false');
                document.body.style.overflow = 'hidden';

                // Focus the close button when modal opens
                setTimeout(() => closeModalBtn.focus(), 100);

                // Close mobile menu if open
                if (navLinks && navLinks.classList.contains('active')) {
                    mobileNavToggle.classList.remove('active');
                    navLinks.classList.remove('active');
                }
            });
        });

        const closeModal = () => {
            reservationModal.classList.remove('active');
            reservationModal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';

            // Return focus to the element that opened the modal
            if (lastFocusedElement) {
                lastFocusedElement.focus();
            }
        };

        closeModalBtn.addEventListener('click', closeModal);
        modalOverlay.addEventListener('click', closeModal);

        // Keyboard handling: Escape to close, Tab to trap focus
        document.addEventListener('keydown', (e) => {
            if (!reservationModal.classList.contains('active')) return;

            if (e.key === 'Escape') {
                closeModal();
                return;
            }

            // Trap focus inside modal
            if (e.key === 'Tab') {
                const focusableElements = getFocusableElements();
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey && document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }
        });
    }

    // Smooth scroll for navigation links
    document.querySelectorAll('a[href^="#"]:not([href="#reservation"])').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            if (targetId === '#') return;

            // Close mobile menu if open
            if (navLinks && navLinks.classList.contains('active')) {
                mobileNavToggle.classList.remove('active');
                navLinks.classList.remove('active');
            }

            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                const navOffset = 80;
                const elementPosition = targetElement.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - navOffset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });

    // Simple reveal animation on scroll
    const observerOptions = {
        threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    document.querySelectorAll('.info-content, .info-image, .section-header').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'all 0.8s cubic-bezier(0.165, 0.84, 0.44, 1)';
        observer.observe(el);
    });

    // Testimonials Slider Logic with Auto-play
    const slider = document.querySelector('.testimonials-slider');
    const sliderContainer = document.querySelector('.testimonials-slider-container');
    const prevBtn = document.querySelector('.slider-btn.prev');
    const nextBtn = document.querySelector('.slider-btn.next');

    if (slider && sliderContainer && prevBtn && nextBtn) {
        let currentIndex = 0;
        const cards = document.querySelectorAll('.testimonial-card');
        let autoplayInterval = null;
        const AUTOPLAY_DELAY = 5000; // 5 seconds

        function updateSlider() {
            const cardWidth = cards[0].offsetWidth;
            const gap = parseInt(window.getComputedStyle(slider).gap);
            const moveAmount = currentIndex * (cardWidth + gap);

            slider.style.transform = `translateX(-${moveAmount}px)`;

            // Limit checks
            const visibleWidth = sliderContainer.offsetWidth - (parseInt(window.getComputedStyle(sliderContainer).paddingLeft) * 2);
            const totalWidth = slider.scrollWidth;

            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = moveAmount + visibleWidth >= totalWidth;
        }

        function nextSlide() {
            const cardsVisible = Math.floor(sliderContainer.offsetWidth / cards[0].offsetWidth);
            const visibleWidth = sliderContainer.offsetWidth - (parseInt(window.getComputedStyle(sliderContainer).paddingLeft) * 2);
            const cardWidth = cards[0].offsetWidth;
            const gap = parseInt(window.getComputedStyle(slider).gap);
            const moveAmount = currentIndex * (cardWidth + gap);

            // If at end, loop back to start
            if (moveAmount + visibleWidth >= slider.scrollWidth) {
                currentIndex = 0;
            } else {
                currentIndex += 1;
                if (currentIndex >= cards.length) currentIndex = 0;
            }
            updateSlider();
        }

        function startAutoplay() {
            if (!autoplayInterval) {
                autoplayInterval = setInterval(nextSlide, AUTOPLAY_DELAY);
            }
        }

        function stopAutoplay() {
            if (autoplayInterval) {
                clearInterval(autoplayInterval);
                autoplayInterval = null;
            }
        }

        // Pause on hover
        sliderContainer.addEventListener('mouseenter', stopAutoplay);
        sliderContainer.addEventListener('mouseleave', startAutoplay);

        // Pause on focus (accessibility)
        sliderContainer.addEventListener('focusin', stopAutoplay);
        sliderContainer.addEventListener('focusout', startAutoplay);

        nextBtn.addEventListener('click', () => {
            const cardsVisible = Math.floor(sliderContainer.offsetWidth / cards[0].offsetWidth);
            currentIndex += cardsVisible;
            if (currentIndex >= cards.length) currentIndex = cards.length - 1;
            updateSlider();
        });

        prevBtn.addEventListener('click', () => {
            const cardsVisible = Math.floor(sliderContainer.offsetWidth / cards[0].offsetWidth);
            currentIndex -= cardsVisible;
            if (currentIndex < 0) currentIndex = 0;
            updateSlider();
        });

        window.addEventListener('resize', () => {
            currentIndex = 0;
            updateSlider();
        });

        // Initial setup
        updateSlider();
        startAutoplay();
    }

    // Back to Top Button
    const backToTopBtn = document.getElementById('backToTop');
    if (backToTopBtn) {
        window.addEventListener('scroll', () => {
            if (window.scrollY > 500) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
        });

        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    }

    // Lazy load Google Maps iframe
    const mapIframe = document.querySelector('.location-map iframe[data-src]');
    if (mapIframe) {
        const mapObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const iframe = entry.target;
                    iframe.src = iframe.dataset.src;
                    mapObserver.unobserve(iframe);
                }
            });
        }, { rootMargin: '200px' }); // Load slightly before it comes into view

        mapObserver.observe(mapIframe);
    }
});
